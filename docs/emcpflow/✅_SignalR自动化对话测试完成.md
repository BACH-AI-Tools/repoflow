# âœ… SignalR è‡ªåŠ¨åŒ–å¯¹è¯æµ‹è¯•å®Œæˆ

## ğŸ¯ åŠŸèƒ½å®ç°

å®ç°äº†å®Œæ•´çš„ SignalR è‡ªåŠ¨åŒ– Agent å¯¹è¯æµ‹è¯•åŠŸèƒ½ï¼

## ğŸš€ æ–°å¢å†…å®¹

### æ–°å¢æ–‡ä»¶

**signalr_chat_tester.py** (~200è¡Œ)

**æ ¸å¿ƒç±»**:
- `SignalRChatTester` - SignalR å¯¹è¯æµ‹è¯•å™¨

**æ ¸å¿ƒæ–¹æ³•**:
- `test_conversation()` - æ‰§è¡Œå¯¹è¯æµ‹è¯•
- `_handle_receive_message()` - å¤„ç†æ¥æ”¶æ¶ˆæ¯

### ä¿®æ”¹æ–‡ä»¶

1. **agent_tester.py** - å¯¼å…¥ SignalR æµ‹è¯•å™¨
2. **emcpflow_simple_gui.py** - é›†æˆ SignalR æµ‹è¯•
3. **requirements.txt** - æ·»åŠ  signalrcore ä¾èµ–

## ğŸ“‹ SignalR å¯¹è¯æµ‹è¯•æµç¨‹

```
æ­¥éª¤ 1: å»ºç«‹ SignalR è¿æ¥
   è¿æ¥åˆ°: v5.kaleido.guru/hubs/superagent
   
æ­¥éª¤ 2: è¿æ¥åˆ° Agent
   å‘é€: connect_single_agent
   å‚æ•°: [token, conversation_id]
   æ¥æ”¶: è¿æ¥ Token (UUID)
   
æ­¥éª¤ 3: å‘é€æµ‹è¯•æ¶ˆæ¯
   å‘é€: send_text_message
   å‚æ•° 1: {
     ContentText: "@MCPåç§° é—®é¢˜",
     ConversationID: xxx,
     SelectSkills: [plugin_id],
     ...
   }
   å‚æ•° 2: è¿æ¥ Token
   
æ­¥éª¤ 4: æ¥æ”¶æµå¼å“åº”
   ç›‘å¬: receive äº‹ä»¶
   ç­‰å¾…: SuperAgentProcess == 1000
   æå–: FullContent (å®Œæ•´å›ç­”)
   è¯†åˆ«: Skills (è°ƒç”¨çš„å·¥å…·)
```

## ğŸ“Š æ—¥å¿—è¾“å‡ºç¤ºä¾‹

### å®Œæ•´çš„è‡ªåŠ¨åŒ–å¯¹è¯æµ‹è¯•

```
======================================================================
ğŸ’¬ å¼€å§‹ SignalR è‡ªåŠ¨åŒ–å¯¹è¯æµ‹è¯•
======================================================================

ğŸ“‹ æ­¥éª¤ 1/4: å»ºç«‹ SignalR è¿æ¥...
   ğŸ”— Hub URL: https://v5.kaleido.guru/hubs/superagent
   âœ… SignalR è¿æ¥å·²å»ºç«‹

ğŸ“‹ æ­¥éª¤ 2/4: è¿æ¥åˆ° Agent...
   ğŸ†” ä¼šè¯ID: 5296ddee-de83-45b6-836c-d2822fad475d
   ğŸ“¤ å·²å‘é€è¿æ¥è¯·æ±‚
   ğŸ”‘ è·å–è¿æ¥Token: ebbf3b86-d125-4a79...
   âœ… å·²è¿æ¥åˆ° Agent

ğŸ“‹ æ­¥éª¤ 3/4: å‘é€æµ‹è¯•æ¶ˆæ¯...
   ğŸ“ æµ‹è¯•é—®é¢˜: @å·´èµ«æ•°æ®åˆ†ææœåŠ¡å™¨ ä½ æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Ÿè¯·ä»‹ç»ä¸€ä¸‹ä½ çš„å·¥å…·ã€‚
   âœ… æµ‹è¯•æ¶ˆæ¯å·²å‘é€

ğŸ“‹ æ­¥éª¤ 4/4: æ¥æ”¶ Agent å“åº”...
   â³ ç­‰å¾… Agent å¤„ç†...
   â„¹ï¸ [ç³»ç»Ÿ] ebbf3b86...
   ğŸ’¬ [AgentPartialTextMessage] æ‚¨å¥½ï¼æˆ‘æ˜¯...
   ğŸ’¬ [AgentPartialTextMessage] æˆ‘å¯ä»¥ä¸ºæ‚¨æä¾›...
   ğŸ”§ è°ƒç”¨å·¥å…·: å·´èµ«æ•°æ®åˆ†ææœåŠ¡å™¨
   ğŸ’¬ [AgentPartialTextMessage] æˆ‘çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬...
   âœ… å¯¹è¯å¤„ç†å®Œæˆ (SuperAgentProcess: 1000)

   âœ… Agent å“åº”å®Œæˆ

   ğŸ“ Agent å®Œæ•´å›ç­”:
   ==================================================================
   æ‚¨å¥½ï¼æˆ‘æ˜¯å·´èµ«æ•°æ®åˆ†ææœåŠ¡å™¨ AI åŠ©æ‰‹ã€‚
   
   æˆ‘çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š
   
   ğŸ“Š æ•°æ®åŠ è½½
   - æ”¯æŒ CSVã€Excelã€JSON ç­‰å¤šç§æ ¼å¼
   - å¿«é€ŸåŠ è½½å¤§å‹æ•°æ®é›†
   
   ğŸ“ˆ æ•°æ®åˆ†æ
   - æè¿°æ€§ç»Ÿè®¡
   - åˆ—æ•°æ®åˆ†æ
   - ç›¸å…³æ€§åˆ†æ
   
   ğŸ“‹ æ•°æ®ç®¡ç†
   - åˆ—å‡ºæ‰€æœ‰æ•°æ®é›†
   - æ•°æ®é›†åˆ‡æ¢
   
   æ‚¨å¯ä»¥è®©æˆ‘å¸®æ‚¨åŠ è½½å’Œåˆ†ææ•°æ®ï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨éœ€è¦ä»€ä¹ˆï¼
   ==================================================================

   âœ… Agent è°ƒç”¨äº† MCP å·¥å…·:
      - å·´èµ«æ•°æ®åˆ†ææœåŠ¡å™¨

======================================================================
âœ… SignalR å¯¹è¯æµ‹è¯•å®Œæˆï¼
======================================================================

   âœ… SignalR å¯¹è¯æµ‹è¯•æˆåŠŸï¼
```

## ğŸ¯ æµ‹è¯•ç»“æœå¯¹è¯æ¡†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… å¯¹è¯æµ‹è¯•å®Œæˆï¼                         â”‚
â”‚                                           â”‚
â”‚  å·¥ä½œåŒº: MCP å·¥å‚ (ID: 835)                â”‚
â”‚  ä¼šè¯: å·´èµ«æ•°æ®åˆ†ææœåŠ¡å™¨ è‡ªåŠ¨æµ‹è¯•          â”‚
â”‚  ä¼šè¯ID: 5296ddee-xxx                     â”‚
â”‚                                           â”‚
â”‚  âœ… SignalR è‡ªåŠ¨åŒ–æµ‹è¯•æˆåŠŸï¼  â­           â”‚
â”‚                                           â”‚
â”‚  ğŸ”§ è°ƒç”¨çš„å·¥å…·:                           â”‚
â”‚    â€¢ å·´èµ«æ•°æ®åˆ†ææœåŠ¡å™¨                    â”‚
â”‚                                           â”‚
â”‚  ğŸ“ Agent å›ç­”:                           â”‚
â”‚  æ‚¨å¥½ï¼æˆ‘æ˜¯å·´èµ«æ•°æ®åˆ†ææœåŠ¡å™¨ AI åŠ©æ‰‹ã€‚    â”‚
â”‚  æˆ‘çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬...                       â”‚
â”‚                                           â”‚
â”‚  ğŸ’¡ è¯¦ç»†æ—¥å¿—è¯·æŸ¥çœ‹å¤„ç†æ—¥å¿—çª—å£              â”‚
â”‚                                           â”‚
â”‚                [ç¡®å®š]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æŠ€æœ¯å®ç°

### SignalR è¿æ¥

```python
from signalrcore.hub_connection_builder import HubConnectionBuilder

connection = HubConnectionBuilder() \
    .with_url("https://v5.kaleido.guru/hubs/superagent") \
    .with_automatic_reconnect({
        "type": "interval",
        "intervals": [0, 2, 10, 30]
    }) \
    .build()

# æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨
connection.on("receive", handle_message)

# å¯åŠ¨è¿æ¥
connection.start()
```

### è¿æ¥åˆ° Agent

```python
# å‘é€è¿æ¥è¯·æ±‚
connection.send(
    "connect_single_agent",
    [token, conversation_id]
)

# æ¥æ”¶å“åº”ï¼Œè·å–è¿æ¥ Token
# Content å­—æ®µåŒ…å« UUID æ ¼å¼çš„è¿æ¥ Token
```

### å‘é€æ¶ˆæ¯

```python
message_data = {
    "ContentText": "@MCPåç§° é—®é¢˜",
    "DialogID": str(uuid.uuid4()),
    "ConversationID": conversation_id,
    "FromName": "è‡ªåŠ¨åŒ–æµ‹è¯•",
    "EnumInvodeType": 1,
    "SelectReferenceInfos": [],
    "SkillMode": 1,
    "SelectSkills": [str(plugin_id)],  # é€‰ä¸­çš„æ’ä»¶
    "HistoryCount": 0,
    ...
}

connection.send(
    "send_text_message",
    [message_data, connection_token]  # ä½¿ç”¨è¿æ¥ Token
)
```

### æ¥æ”¶å“åº”

```python
def _handle_receive_message(data):
    msg = data[0]
    
    # æ£€æŸ¥æ¶ˆæ¯ç±»å‹
    msg_type = msg.get('MessageType')
    
    if msg_type == 'AgentPartialTextMessage':
        # æµå¼è¾“å‡ºï¼ˆéƒ¨åˆ†å†…å®¹ï¼‰
        partial = msg.get('Content')
        full = msg.get('FullContent')  # å®Œæ•´å†…å®¹
    
    elif msg_type == 'AgentTextMessage':
        # å®Œæ•´æ¶ˆæ¯
        content = msg.get('Content')
    
    # æ£€æŸ¥æŠ€èƒ½è°ƒç”¨
    skills = msg.get('Skills', [])
    for skill in skills:
        skill_name = skill.get('SkillName')
        # MCP å·¥å…·è¢«è°ƒç”¨
    
    # æ£€æŸ¥æ˜¯å¦å®Œæˆ
    if msg.get('SuperAgentProcess') == 1000:
        # å¯¹è¯å¤„ç†å®Œæˆ
        is_complete = True
```

## ğŸ“Š å¯¹æ¯”

### æ‰‹åŠ¨æµ‹è¯• âŒ

```
1. è®¿é—®é“¾æ¥
2. è¿›å…¥å·¥ä½œåŒº
3. æ‰¾åˆ°ä¼šè¯
4. è¾“å…¥æ¶ˆæ¯
5. è§‚å¯Ÿç»“æœ
6. éªŒè¯å·¥å…·è°ƒç”¨

è€—æ—¶: 2-5åˆ†é’Ÿ
äººå·¥: 100%
```

### SignalR è‡ªåŠ¨åŒ– âœ…

```
1. ç‚¹å‡»æŒ‰é’®
2. ç­‰å¾…å®Œæˆ
3. æŸ¥çœ‹ç»“æœ

è€—æ—¶: 20-30ç§’
è‡ªåŠ¨åŒ–: 100%  â­
```

**èŠ‚çœæ—¶é—´: 80-90%**

## ğŸ¯ æ£€æµ‹å’ŒéªŒè¯

### è‡ªåŠ¨æ£€æµ‹

- âœ… Agent æ˜¯å¦è°ƒç”¨ MCP å·¥å…·
- âœ… æå–è°ƒç”¨çš„å·¥å…·åç§°
- âœ… è·å–å®Œæ•´å›ç­”å†…å®¹
- âœ… ç­‰å¾…å¤„ç†å®Œæˆï¼ˆSuperAgentProcess: 1000ï¼‰

### ç»“æœéªŒè¯

```python
result = {
    "success": True/False,
    "full_content": "Agent çš„å®Œæ•´å›ç­”",
    "skills_used": ["å·¥å…·1", "å·¥å…·2"],
    "messages": [æ‰€æœ‰æ¥æ”¶çš„æ¶ˆæ¯],
    "error": "é”™è¯¯ä¿¡æ¯(å¦‚æœæœ‰)"
}
```

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: å¿«é€ŸéªŒè¯

```
å‘å¸ƒ â†’ Agentæµ‹è¯• â†’ æµ‹è¯•èŠå¤© (è‡ªåŠ¨åŒ–) â†’ âœ… ç«‹å³çœ‹åˆ°ç»“æœ
```

### åœºæ™¯ 2: æ‰¹é‡æµ‹è¯•

```
for mcp in mcp_list:
    å‘å¸ƒ â†’ Agentæµ‹è¯• â†’ æµ‹è¯•èŠå¤© (è‡ªåŠ¨åŒ–)
    ä¿å­˜ç»“æœ
```

### åœºæ™¯ 3: CI/CD

```
è‡ªåŠ¨å‘å¸ƒ â†’ è‡ªåŠ¨æµ‹è¯• â†’ éªŒè¯é€šè¿‡ â†’ è‡ªåŠ¨éƒ¨ç½²
```

## ğŸ“¦ ä¾èµ–å®‰è£…

```bash
pip install signalrcore
```

**åŒ…å«**:
- signalrcore==0.9.5
- websocket-client==1.0.0
- msgpack==1.0.2

## âš™ï¸ é…ç½®

### è‡ªåŠ¨æ£€æµ‹

ä»£ç ä¼šè‡ªåŠ¨æ£€æµ‹ signalrcore æ˜¯å¦å®‰è£…ï¼š
- âœ… å·²å®‰è£… â†’ ä½¿ç”¨ SignalR è‡ªåŠ¨åŒ–æµ‹è¯•
- âŒ æœªå®‰è£… â†’ æç¤ºæ‰‹åŠ¨æµ‹è¯•

### é™çº§ç­–ç•¥

```
å°è¯• SignalR è‡ªåŠ¨åŒ–
   â†“ å¤±è´¥
æä¾›æ‰‹åŠ¨æµ‹è¯•æŒ‡å—
   â†“
ç¯å¢ƒå·²å‡†å¤‡ï¼Œç”¨æˆ·æ‰‹åŠ¨æµ‹è¯•
```

## ğŸ‰ æœ€ç»ˆæ•ˆæœ

### å®Œæ•´è‡ªåŠ¨åŒ–

```
[ğŸš€ å‘å¸ƒ] â†’ [ğŸ¤– Agentæµ‹è¯•] â†’ [ğŸ’¬ æµ‹è¯•èŠå¤©]
   30s          30s              30s
                                  â†“
                            SignalR è‡ªåŠ¨å¯¹è¯ â­
                                  â†“
                         ç«‹å³çœ‹åˆ° Agent å›ç­”å’Œå·¥å…·è°ƒç”¨ âœ…
```

**100% è‡ªåŠ¨åŒ–ï¼**

### å¯¹è¯æ¡†æ˜¾ç¤º

```
âœ… å¯¹è¯æµ‹è¯•å®Œæˆï¼

âœ… SignalR è‡ªåŠ¨åŒ–æµ‹è¯•æˆåŠŸï¼  â­

ğŸ”§ è°ƒç”¨çš„å·¥å…·:
  â€¢ å·´èµ«æ•°æ®åˆ†ææœåŠ¡å™¨  â­ è‡ªåŠ¨æ£€æµ‹

ğŸ“ Agent å›ç­”:  â­ è‡ªåŠ¨è·å–
æ‚¨å¥½ï¼æˆ‘æ˜¯å·´èµ«æ•°æ®åˆ†ææœåŠ¡å™¨...

ğŸ’¡ è¯¦ç»†æ—¥å¿—è¯·æŸ¥çœ‹å¤„ç†æ—¥å¿—çª—å£
```

## ğŸŠ å®ŒæˆåŠŸèƒ½

- [x] âœ… å®‰è£… signalrcore
- [x] âœ… åˆ›å»º SignalRChatTester ç±»
- [x] âœ… å®ç° SignalR è¿æ¥
- [x] âœ… å®ç° connect_single_agent
- [x] âœ… å®ç° send_text_message
- [x] âœ… å®ç°æµå¼å“åº”æ¥æ”¶
- [x] âœ… æ£€æµ‹ SuperAgentProcess: 1000
- [x] âœ… æå–å®Œæ•´å›ç­”
- [x] âœ… è¯†åˆ«å·¥å…·è°ƒç”¨
- [x] âœ… é›†æˆåˆ° GUI
- [x] âœ… è‡ªåŠ¨é™çº§ç­–ç•¥

## ğŸŠ ç»ˆæå®Œæˆ

**EMCPFlow ç°å·²æ”¯æŒå®Œå…¨è‡ªåŠ¨åŒ–çš„ç«¯åˆ°ç«¯æµ‹è¯•ï¼**

```
åŒ…åœ°å€ â†’ 30ç§’ â†’ MCP å‘å¸ƒ + Logo
   â†“
MCP æµ‹è¯• â†’ 1-2åˆ†é’Ÿ â†’ HTML æŠ¥å‘Š (å¯é€‰)
   â†“
Agent æµ‹è¯• â†’ 30ç§’ â†’ Agent åˆ›å»º
   â†“
SignalR å¯¹è¯ â†’ 30ç§’ â†’ è‡ªåŠ¨å¯¹è¯æµ‹è¯• â­
   â†“
âœ… å®Œæ•´éªŒè¯ï¼
```

**æ€»è€—æ—¶**: 2-3 åˆ†é’Ÿ  
**è‡ªåŠ¨åŒ–**: 100% â­

---

**å®ç°æ—¶é—´**: 2025-11-06  
**åŠŸèƒ½**: SignalR è‡ªåŠ¨åŒ–å¯¹è¯æµ‹è¯•  
**ä¾èµ–**: signalrcore  
**å¼€å‘**: å·´èµ«å·¥ä½œå®¤ (BACH Studio)

**Made with â¤ï¸ by å·´èµ«å·¥ä½œå®¤**

